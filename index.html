<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prices - Product Information</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Light Mode Defaults */
        body {
            font-family: -apple-system, BlinkMacMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            direction: rtl;
            text-align: right;
            margin: 0; 
            background-color: #f0f0f0; 
            display: flex; 
            min-height: 100vh; 
            box-sizing: border-box;
            position: relative; 
            overflow-x: hidden; 
            color: #333; /* Default text color for light mode */
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Dark Mode Styles */
        body.dark-mode {
            background-color: #1a1a2e; /* Dark background */
            color: #e0e0e0; /* Light text */
        }

        /* Open sidebar button */
        .open-sidebar-btn {
            position: fixed; 
            top: 20px;
            right: 20px; 
            font-size: 30px;
            background: none;
            border: none;
            color: #343a40; 
            cursor: pointer;
            z-index: 1001; 
            transition: color 0.3s ease;
        }
        body.dark-mode .open-sidebar-btn {
            color: #f0f0f0; /* Light color for dark mode */
        }
        .open-sidebar-btn:hover {
            color: #007bff;
        }

        /* Sidebar */
        .sidebar {
            height: 100%; 
            width: 0; 
            position: fixed; 
            z-index: 1000; 
            top: 0;
            right: 0; 
            background-color: #343a40; /* Dark background for sidebar in light mode */
            overflow-x: hidden; 
            transition: 0.5s; 
            padding-top: 60px; 
            box-shadow: -2px 0 5px rgba(0,0,0,0.2);
            white-space: nowrap; 
        }

        body.dark-mode .sidebar {
            background-color: #16213e; /* Even darker for sidebar in dark mode */
        }

        .sidebar.active {
            width: 250px; 
        }

        .sidebar h3 {
            text-align: center;
            margin-bottom: 30px;
            color: #ffffff;
            font-size: 1.5em;
            padding: 0 20px; 
        }

        .sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar ul li {
            margin-bottom: 15px;
        }

        .sidebar ul li a {
            color: white;
            text-decoration: none;
            display: block;
            padding: 10px 20px; 
            border-radius: 5px;
            transition: background-color 0.3s ease;
            display: flex;
            align-items: center;
        }
        
        /* New styles for dropdown */
        .sidebar ul li.dropdown > a {
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .sidebar ul li.dropdown > a .dropdown-icon {
            margin-right: 10px; /* Adjust as needed for RTL */
            transition: transform 0.3s ease;
        }

        .sidebar ul li.dropdown > a .dropdown-icon.rotated {
            transform: rotate(90deg);
        }

        .sidebar ul li .dropdown-content {
            display: none;
            list-style: none;
            padding: 0;
            margin: 0;
            background-color: #2b2b3b; /* Slightly darker for dropdown background */
            border-radius: 5px;
            margin-top: 5px;
        }
        body.dark-mode .sidebar ul li .dropdown-content {
            background-color: #0f182c;
        }


        .sidebar ul li .dropdown-content.active {
            display: block;
        }

        .sidebar ul li .dropdown-content li a {
            padding: 8px 30px; /* Indent sub-items */
            font-size: 0.9em;
        }
        /* End new styles for dropdown */

        .sidebar ul li a:hover,
        .sidebar ul li a.active {
            background-color: #007bff; 
        }

        .sidebar ul li a i {
            margin-left: 10px; 
            font-size: 1.2em;
        }

        /* Close sidebar button */
        .closebtn {
            position: absolute;
            top: 0;
            left: 25px; 
            font-size: 36px;
            margin-left: 50px;
            color: #f1f1f1;
            text-decoration: none;
            transition: 0.3s;
        }
        .closebtn:hover {
            color: #007bff;
        }

        /* Overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4); 
            z-index: 999; 
            display: none; 
        }
        .overlay.active {
            display: block;
        }

        /* Main content container */
        .main-content {
            flex-grow: 1; 
            display: flex;
            justify-content: center; 
            align-items: flex-start; 
            padding: 20px; 
            box-sizing: border-box;
            transition: margin-right 0.5s ease; 
            margin-right: 0; 
        }

        /* Push content when sidebar is open */
        body.sidebar-open .main-content {
            margin-right: 250px; 
        }

        /* A4 landscape page container */
        .page-container {
            background-color: white; /* Light mode default */
            box-shadow: 0 0 10px rgba(0,0,0,0.1); 
            padding: 20mm; 
            box-sizing: border-box;
            max-width: 1122px; 
            flex-grow: 1; 
            min-height: 794px; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            text-align: center; 
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }
        body.dark-mode .page-container {
            background-color: #2b2b3b; /* Darker background for page */
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
        }
        
        h2 {
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        body.dark-mode table {
            background-color: #3a3a4c;
            color: #e0e0e0;
            box-shadow: 0 2px 7px rgba(0,0,0,0.3);
        }

        th, td {
            border: 1px solid #dddddd; /* Light mode default */
            text-align: center;
            padding: 12px;
            transition: border-color 0.3s ease;
        }
        body.dark-mode th, body.dark-mode td {
            border: 1px solid #555566; /* Darker border */
        }

        thead {
            background-color: #f2f2f2; /* Light mode default */
            transition: background-color 0.3s ease;
        }
        body.dark-mode thead {
            background-color: #4a4a5c; /* Darker header */
        }
        tbody tr:nth-child(even) {
            background-color: #f9f9f9; /* Light mode default */
            transition: background-color 0.3s ease;
        }
        body.dark-mode tbody tr:nth-child(even) {
            background-color: #313141; /* Darker even rows */
        }

        /* Highlight row on click */
        .highlight {
            background-color: #d1edda !important; /* Light green, using !important to ensure override */
            transition: background-color 0.3s ease;
        }
        body.dark-mode .highlight {
            background-color: #5cb85c !important; /* A darker green for dark mode */
        }


        /* Search and Autocomplete styles */
        .search-container {
            text-align: center;
            margin: 20px 0;
            flex-shrink: 0; 
            display: flex; /* Use flexbox for layout */
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
            justify-content: center;
            gap: 10px; /* Space between items */
        }
        .autocomplete {
            position: relative;
            display: inline-block;
            width: 300px; 
            min-width: 200px; /* Ensure it's not too small */
        }
        #searchInput, #brandFilter {
            padding: 10px;
            width: 100%; /* Take full width of parent */
            border-radius: 5px;
            border: 1px solid #ddd;
            font-family: inherit;
            background-color: #fff; /* Light mode default */
            color: #333;
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }
        body.dark-mode #searchInput, body.dark-mode #brandFilter {
            background-color: #3a3a4c; /* Darker input */
            border: 1px solid #555566;
            color: #e0e0e0;
        }
        #searchButton {
            padding: 10px 20px;
            border-radius: 5px;
            border: none;
            background-color: #007bff;
            color: white;
            cursor: pointer;
            font-family: inherit;
            vertical-align: top;
            transition: background-color 0.3s ease;
        }
        #searchButton:hover {
            background-color: #0056b3;
        }
        .autocomplete-items {
            position: absolute;
            border: 1px solid #d4d4d4; /* Light mode default */
            border-bottom: none;
            border-top: none;
            z-index: 99;
            top: 100%;
            left: 0;
            right: 0;
            background-color: #fff; /* Light mode default */
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        body.dark-mode .autocomplete-items {
            border: 1px solid #555566;
            background-color: #3a3a4c;
        }
        .autocomplete-items div {
            padding: 10px;
            cursor: pointer;
            background-color: #fff; /* Light mode default */
            border-bottom: 1px solid #d4d4d4; /* Light mode default */
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        body.dark-mode .autocomplete-items div:hover {
            background-color: #e9e9e9; /* Light mode default */
        }
        body.dark-mode .autocomplete-items div:hover {
            background-color: #555566; /* Darker hover */
        }
        .autocomplete-active {
            background-color: DodgerBlue !important; 
            color: #ffffff; 
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: #fefefe; /* Light mode default */
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 800px;
            border-radius: 8px;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        body.dark-mode .modal-content {
            background-color: #2b2b3b; /* Darker modal content */
            border: 1px solid #555;
            color: #e0e0e0;
        }
        .close {
            color: #aaa; /* Light mode default */
            float: left;
            font-size: 28px;
            font-weight: bold;
            transition: color 0.3s ease;
        }
        body.dark-mode .close {
            color: #ccc;
        }
        .close:hover,
        .close:focus {
            color: black; /* Light mode default */
            text-decoration: none;
            cursor: pointer;
        }
        body.dark-mode .close:hover,
        body.dark-mode .close:focus {
            color: #fff;
        }
        #modal-body table {
            width: 100%;
            margin-top: 15px;
        }

        /* Dark Mode Toggle Button */
        #darkModeToggle {
            position: fixed;
            top: 20px;
            left: 20px;
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            z-index: 1001;
            color: #343a40; /* Light mode default */
            transition: color 0.3s ease;
        }
        body.dark-mode #darkModeToggle {
            color: #f0f0f0; /* Dark mode color */
        }
        #darkModeToggle:hover {
            color: #007bff;
        }

        /* Responsive styles for mobile */
        @media only screen and (max-width: 768px) {
            .open-sidebar-btn {
                font-size: 24px; 
                top: 15px;
                right: 15px;
            }
            .sidebar.active {
                width: 70vw; 
            }
            body.sidebar-open .main-content {
                margin-right: 70vw; 
            }
            .closebtn {
                font-size: 30px;
                left: 15px;
                margin-left: 0;
            }
            .main-content {
                padding: 10px; 
            }
            .page-container {
                width: 98vw; 
                height: auto; 
                min-height: auto;
                padding: 10px; 
                margin: 10px auto; 
                box-shadow: none; 
            }
            table {
                font-size: 0.7em; 
                overflow-x: auto; 
                display: block; 
                white-space: nowrap; 
            }
            th, td {
                padding: 5px; 
            }
            .autocomplete {
                width: 95%; 
            }
            h2 {
                font-size: 1em; 
            }
            #darkModeToggle {
                font-size: 24px;
                top: 15px;
                left: 15px;
            }
        }

        /* Print styles */
        @media print {
            @page {
                size: A4 landscape; 
                margin: 10mm; 
            }
            body {
                margin: 0; 
                -webkit-print-color-adjust: exact; 
                print-color-adjust: exact;
                display: block; 
                padding: 0;
                overflow-x: visible; 
                color: #000; /* Ensure black text on print */
                background-color: #fff; /* Ensure white background on print */
            }
            .sidebar, .open-sidebar-btn, .overlay, .search-container, #searchButton, .modal, #darkModeToggle {
                display: none; 
            }
            table, th, td {
                border-color: #000 !important; 
                color: #000 !important;
            }
            thead, tbody tr:nth-child(even) {
                background-color: #f2f2f2 !important; /* Keep a light background for tables on print */
            }
            #modal-body table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 0; 
            }
            .page-container {
                width: auto;
                min-height: auto;
                box-shadow: none;
                padding: 0;
                margin: 0;
            }
            .main-content {
                margin-right: 0 !important; 
                padding: 0;
            }
        }
    </style>
</head>
<body>
    
    <button class="open-sidebar-btn" id="openSidebarBtn">
        <i class="fas fa-bars"></i> 
    </button>

    <button id="darkModeToggle">
        <i class="fas fa-moon" id="darkModeIcon"></i> 
    </button>

    
    <div class="sidebar" id="mySidebar">
        <a href="javascript:void(0)" class="closebtn" id="closeSidebarBtn">&times;</a> 
        <h3>Management</h3>
        <ul>
            <li class="dropdown">
                <a>
                    <i class="fas fa-money-bill-wave"></i>
                    <span>قیمت محصولات</span>
                    <i class="fas fa-chevron-left dropdown-icon"></i>
                </a>
                <ul class="dropdown-content">
                    <li><a href="#" data-product="razavi"><i class="fas fa-box-open"></i> محصولات رضوی</a></li>
                    <li><a href="#" data-product="gildokht"><i class="fas fa-seedling"></i> محصولات گیل‌دخت</a></li>
                    <li><a href="#" data-product="khatomeh"><i class="fas fa-cookie"></i> محصولات خاتومه</a></li>
                </ul>
            </li>
            <li class="dropdown">
                <a>
                    <i class="fas fa-barcode"></i>
                    <span>ایرانکد و بارکد</span>
                    <i class="fas fa-chevron-left dropdown-icon"></i>
                </a>
                <ul class="dropdown-content">
                    <li><a href="#" data-product="irancode-barcode"><i class="fas fa-code"></i> مشاهده اطلاعات</a></li>
                </ul>
            </li>
        </ul>
    </div>

    
    <div class="overlay" id="myOverlay"></div>

    
    <div class="main-content" id="mainContent">
        <div class="page-container" id="pageContainer">
            <div id="welcomeMessage">
                <h1>Welcome</h1>
                <p style="font-size: 1.1em;">Please select a product from the menu to view the information</p>
                <div id="shamsiDateTime" style="margin-top: 30px; font-size: 1.2em; font-weight: bold;"></div>
                <p style="margin-top: 10px; font-size: 1em; color: #555;">Made by Ali Asemani</p>
            </div>
            <div id="productSpecificContent" style="display: none;">
                </div>
        </div> 
    </div> 

    <div id="resultModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <div id="modal-body"></div>
      </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Modal elements
    const modal = document.getElementById('resultModal');
    const closeModal = document.getElementsByClassName('close')[0];
    const modalBody = document.getElementById('modal-body');

    // Sidebar elements
    const openSidebarBtn = document.getElementById('openSidebarBtn');
    const closeSidebarBtn = document.getElementById('closeSidebarBtn');
    const mySidebar = document.getElementById('mySidebar');
    const myOverlay = document.getElementById('myOverlay');
    const mainContent = document.getElementById('mainContent');

    // Content areas
    const welcomeMessageDiv = document.getElementById('welcomeMessage');
    const productSpecificContentDiv = document.getElementById('productSpecificContent');
    const shamsiDateTimeDiv = document.getElementById('shamsiDateTime');

    // Dark Mode Toggle elements
    const darkModeToggle = document.getElementById('darkModeToggle');
    const darkModeIcon = document.getElementById('darkModeIcon');

    // --- START OF NEW DATA FOR IRANCODE AND BARCODE TABLE ---
    const productLines = [
        'بکینگ پودر، 180 g، خاتومه', 'نبات شاخه سفید، 450 g، مسیر سبز', 'چای سیاه آسام گرانول، 5 kg، مسیر سبز', 'نبات زعفرانی، نی دار، 26 عددی، خاتومه', 'شکر قهوه ای، 700 گرم، گیل دخت',
        'شکر، قهوه ای، 700 گرم، گیل دخت', 'شکر، قهوه ای، 900 گرم، گیل دخت', 'دارچین پودر شده، 100 g، مسیر سبز', 'ادویه مخلوط ماست و خیار گرانول، 75 g، مسیر سبز', 'بیکینگ پودر، 160 g، خاتومه',
        'بیکینگ پودر، 180 g، مسیر سبز', 'شکر سفید، 700 g، گیل دخت', 'شکر قهوه ای، 700 گرم، خاتومه', 'آویشن پودر شده، 60 g، مسیر سبز', 'آویشن پودر شده، 60 g، خاتومه',
        'زیره سبز پودر شده، 100 g، خاتومه', 'فلفل سیاه پودر شده، 75 g، خاتومه', 'دارچین پودر شده، 50 g، خاتومه', 'چای سیاه CTC کنیا گرانول، 100 g، مسیر سبز', 'نبات، زعفرانی، نی دار، 10 عددی، خاتومه',
        'نبات شاخه سفید، 450 g، خاتومه', 'ادویه مخلوط سالاد گرانول، 80 g، مسیر سبز', 'ادویه مخلوط چهار زیره گرانول، 100 g، مسیر سبز', 'نمک گرانول، 250 g، مسیر سبز', 'زنجبیل پودر شده، 100 g، خاتومه',
        'دارچین پودر شده، 100 g، خاتومه', 'نبات نی دار زعفرانی، 10 عددی، مسیر سبز', 'چای سیاه CTC کنیا گرانول، 500 g، مسیر سبز', 'قند سفید، شکسته، 700 g، گیل دخت', 'شکر، قهوه ای، 700 گرم، خاتومه',
        'زنجبیل پودر شده، 80 g، مسیر سبز', 'فلفل قرمز پودر شده، 100 g، مسیر سبز', 'زعفران سرگل، 4.6 g، خاتومه', 'ادویه کاری پودر شده، 100 g، خاتومه', 'بیکینگ پودر، 160 g، مسیر سبز',
        'شکر سفید، 900 g، گیل دخت', 'شکر قهوه ای، 900 گرم، خاتومه', 'شکر، قهوه ای، 900 گرم، خاتومه', 'ادویه کاری پودر شده، 100 g، مسیر سبز', 'سیر پودر شده خشک، 120 g، خاتومه',
        'ادویه مخلوط چهار زیره گرانول، 75 g، خاتومه', 'فلفل سیاه پودر شده، 100 g، خاتومه', 'زردچوبه، 90 g، خاتومه', 'چای سیاه ctc کنیا گرانول، 500 g، خاتومه', 'چای سیاه ctc گرانول، 100 g، خاتومه',
        'شکر سفید، 900 g، خاتومه', 'زردچوبه پودر شده، 100 g، مسیر سبز', 'سماق گرانول، 100 g، مسیر سبز', 'ادویه مخلوط مرغ و ماهی گرانول، 100 g، مسیر سبز', 'زعفران سرگل، 1 g، خاتومه',
        'زعفران سرگل، 9.2 g، خاتومه', 'فلفل قرمز پودر شده، 75 g، گیل دخت', 'نبات نی دار زعفرانی، 26 عددی، مسیر سبز', 'چای سیاه آسام گرانول، 5 kg، خاتومه', 'قند سفید، شکسته، 700 g، خاتومه',
        'شکر سفید، 900 g، گیل دخت', 'فلفل سیاه پودر شده، 100 g، مسیر سبز', 'ادویه مخلوط کباب گرانول، 100 g، مسیر سبز', 'زنجبیل پودر شده، 75 g، خاتومه', 'زعفران سرگل، 0.2 g، خاتومه',
        'زعفران سرگل، 0.5 g، خاتومه', 'قند سفید، شکسته، 450 g، گیل دخت', 'شکر سفید، 3 kg، گیل دخت', 'شکر قهوه ای، 900 گرم، گیل دخت', 'پودر سیر خشک شده، 120 g، مسیر سبز',
        'زیره سبز پودر شده، 100 g، مسیر سبز', 'سماق، گرانول، 100 گرم، خاتومه', 'زعفران سرگل، 2.3 g، خاتومه', 'فلفل قرمز پودر شده، 50 g، خاتومه', 'زردچوبه، 350 g، خاتومه',
        'نمک گرانول، 230 g، مسیر سبز', 'زردچوبه، 100 g، خاتومه', 'ادویه کاری پودر شده، 75 g، خاتومه', 'زردچوبه، 600 g، خاتومه', 'هل سبز، 10 g، خاتومه',
        'ادویه کاری مخلوط، 90 g، خاتومه', 'فلفل قرمز پودر شده، 30 g، خاتومه', 'فلفل سیاه پودر شده، 80 g، خاتومه', 'زردچوبه پودر شده، 90 g، گیل دخت', 'پودر سیر، 100 g، گیل دخت',
        'زرد چوبه پودر شده، 50 g، گیل دخت', 'دارچین پودر شده، 80 g، گیل دخت', 'ادویه، مخلوط کباب، 100 گرم، خاتومه', 'نمک گرانول، 250 g، خاتومه', 'سماق پودر شده، 75 گرم، خاتومه',
        'دارچین، پودر شده، 75 گرم، خاتومه', 'سماق پودر شده، 50 g، خاتومه', 'ادویه کاری، 50 g، خاتومه', 'ادویه کاری، 80 g، خاتومه', 'فلفل سیاه پودر شده، 90 g، گیل دخت',
        'زنجبیل پودر شده، 80 g، گیل دخت', 'فلفل قرمز پودر شده، 50 g خاتومه', 'ادویه مخلوط مرغ و ماهی، 100 g، خاتومه', 'زرد چوبه پودر شده، 50 g، خاتومه', 'فلفل سیاه پودر شده، 50 g، خاتومه',
        'سماق پودر شده، 30 g، خاتومه', 'ادویه کاری، 30 g، خاتومه', 'زنجبیل پودر شده، 80 g، خاتومه', 'فلفل سیاه پودر شده، 50 g، گیل دخت', 'فلفل قرمز پودر شده، 100 g، خاتومه',
        'فلفل قرمز پودر شده، 100 g، خاتومه', 'ادویه، مخلوط کباب، 80 g، خاتومه', 'ادویه مخلوط چهار زیره، 80 g، خاتومه', 'زرد چوبه پودرشده، 100 گرم، خاتومه', 'فلفل قرمز پودر شده، 75 گرم، خاتومه',
        'دارچین پودر شده، 75 گرم، خاتومه', 'فلفل سیاه پودر شده، 30 g، خاتومه', 'ادویه کاری پودر شده، 50 g، گیل دخت', 'زنجبیل پودر شده، 50 g، گیل دخت', 'ادویه مخلوط سالاد گرانول، 100 g، خاتومه',
        'نمک گرانول، 230 g، خاتومه', 'دارچین پودر شده، 30 g، خاتومه', 'زنجبیل پودر شده، 30 g، خاتومه', 'زنجبیل پودر شده، 50 g، خاتومه', 'فلفل قرمز پودر شده، 80 g، خاتومه',
        'فلفل سیاه پودر شده، 80 g، گیل دخت', 'زردچوبه پودر شده، 80 g، گیل دخت', 'زنجبیل پودر شده، 90 g، گیل دخت', 'ادویه مخلوط مرغ و ماهی، 80 g، خاتومه', 'آویشن پودر شده، 50 g، خاتومه',
        'آویشن پودر شده، 30 g، خاتومه', 'زرد چوبه پودر شده، 80 g، خاتومه', 'ادویه کاری پودر شده، 75 g، گیل دخت', 'آویشن پودر شده، 50 g، گیل دخت', 'فلفل قرمز پودر شده، 90 g، گیل دخت',
        'آویشن پودر شده، 60 g، گیل دخت', 'دارچین پودر شده، 75 g، گیل دخت', 'پودر سیر، 50 g، خاتومه', 'آویشن پودر شده، 50 g، خاتومه', 'زرد چوبه پودرشده، 75 گرم، خاتومه',
        'زرد چوبه پودر شده، 30 g، خاتومه', 'فلفل سیاه پودر شده، 75 g، گیل دخت', 'فلفل قرمز پودر شده، 80 g، گیل دخت', 'ادویه کاری، 90 g، گیل دخت', 'زرد چوبه پودر شده، 75 g، گیل دخت',
        'زنجبیل پودر شده، 75 g، گیل دخت', 'پودر سیر، 75 g، خاتومه', 'پودر سیر، 100 g، خاتومه', 'سماق پودر شده، 90 g، گیل دخت', 'دارچین پودر شده، 80 g، خاتومه',
        'ادویه کاری، 80 g، گیل دخت', 'سماق پودر شده، 80 g، گیل دخت', 'فلفل قرمز پودر شده، 50 g، گیل دخت', 'دارچین پودر شده، 90 g، گیل دخت', 'دارچین پودر شده، 50 g، گیل دخت',
        'سماق پودر شده، 75 g، گیل دخت', 'سماق پودر شده، 50 g، گیل دخت', 'آویشن پودر شده، 50 g، گیل دخت'
    ];
    
    const brands = [
        'خاتومه', 'مسیر سبز', 'مسیر سبز', 'خاتومه', 'گیل دخت',
        'گیل دخت', 'گیل دخت', 'مسیر سبز', 'مسیر سبز', 'خاتومه',
        'مسیر سبز', 'گیل دخت', 'خاتومه', 'مسیر سبز', 'خاتومه',
        'خاتومه', 'خاتومه', 'خاتومه', 'مسیر سبز', 'خاتومه',
        'خاتومه', 'مسیر سبز', 'مسیر سبز', 'مسیر سبز', 'خاتومه',
        'خاتومه', 'مسیر سبز', 'مسیر سبز', 'گیل دخت', 'خاتومه',
        'مسیر سبز', 'مسیر سبز', 'خاتومه', 'خاتومه', 'مسیر سبز',
        'گیل دخت', 'خاتومه', 'خاتومه', 'مسیر سبز', 'خاتومه',
        'خاتومه', 'خاتومه', 'خاتومه', 'خاتومه', 'خاتومه',
        'خاتومه', 'مسیر سبز', 'مسیر سبز', 'مسیر سبز', 'خاتومه',
        'خاتومه', 'گیل دخت', 'مسیر سبز', 'خاتومه', 'خاتومه',
        'گیل دخت', 'مسیر سبز', 'مسیر سبز', 'خاتومه', 'خاتومه',
        'خاتومه', 'گیل دخت', 'گیل دخت', 'گیل دخت', 'مسیر سبز',
        'مسیر سبز', 'خاتومه', 'خاتومه', 'خاتومه', 'خاتومه',
        'مسیر سبز', 'خاتومه', 'خاتومه', 'خاتومه', 'خاتومه',
        'خاتومه', 'خاتومه', 'خاتومه', 'گیل دخت', 'گیل دخت',
        'گیل دخت', 'گیل دخت', 'خاتومه', 'خاتومه', 'خاتومه',
        'خاتومه', 'خاتومه', 'خاتومه', 'خاتومه', 'گیل دخت',
        'گیل دخت', 'خاتومه', 'خاتومه', 'خاتومه', 'خاتومه',
        'خاتومه', 'خاتومه', 'خاتومه', 'گیل دخت', 'خاتومه',
        'خاتومه', 'خاتومه', 'خاتومه', 'خاتومه', 'خاتومه',
        'خاتومه', 'خاتومه', 'گیل دخت', 'گیل دخت', 'خاتومه',
        'خاتومه', 'خاتومه', 'خاتومه', 'خاتومه', 'خاتومه',
        'گیل دخت', 'گیل دخت', 'گیل دخت', 'خاتومه', 'خاتومه',
        'خاتومه', 'خاتومه', 'گیل دخت', 'گیل دخت', 'گیل دخت',
        'گیل دخت', 'گیل دخت', 'خاتومه', 'خاتومه', 'خاتومه',
        'خاتومه', 'گیل دخت', 'گیل دخت', 'گیل دخت', 'گیل دخت',
        'گیل دخت', 'خاتومه', 'خاتومه', 'گیل دخت', 'خاتومه',
        'گیل دخت', 'گیل دخت', 'گیل دخت', 'گیل دخت', 'گیل دخت',
        'گیل دخت', 'گیل دخت', 'گیل دخت'
    ];

    const barcodes = [
        '6260002530705', '6260001319998', '6260001341326', '6260002532068', '6262238322246',
        '6262238322260', '6262238322277', '6260001182264', '6260001319929', '6260001182219',
        '6260002530798', '6260303700333', '6262238322215', '6260001182233', '6260002532006',
        '6260002532020', '6260002518468', '6260002518482', '6260001341340', '6260002532051',
        '6260002532075', '6260001319912', '6260001319936', '6260001319974', '6260002532624',
        '6260002518499', '6260001341319', '6260001341333', '6260303700357', '6262238322239',
        '6260001182257', '6260001182271', '6260002518437', '6260002518451', '6260001182202',
        '6260303700326', '6262238322208', '6262238322222', '6260001182226', '6260002532013',
        '6260002532037', '6260002518475', '6260001341395', '6260002532099', '6260002532600',
        '6260303700364', '6260001182295', '6260001319943', '6260001319950', '6260002518406',
        '6260002518413', '6260004512464', '6260001341302', '6260002532082', '6260303700371',
        '6260303700388', '6260001182288', '6260001319967', '6260002532617', '6260001341364',
        '6260001341371', '6260303700340', '6260303700395', '6262238322253', '6260001182240',
        '6260001319905', '6260002532044', '6260002518420', '6260002530712', '6260002532655',
        '6260001319981', '6260001341357', '6260002518444', '6260001341388', '6260002530736',
        '6260002532679', '6260004277127', '6260004281797', '6260004512433', '6260004512532',
        '6260004512549', '6260004512648', '6260002530750', '6260002530774', '6260002676632',
        '6260002676656', '6260004277165', '6260004281711', '6260004281766', '6260004512419',
        '6260004512563', '6260002530729', '6260002530743', '6260004277110', '6260004277134',
        '6260004277158', '6260004281704', '6260004281780', '6260004512426', '6260002532631',
        '6260002532648', '6260002532662', '6260002532686', '6260002676618', '6260002676625',
        '6260002676649', '6260004277189', '6260004512600', '6260004512655', '6260002530767',
        '6260002530781', '6260004277172', '6260004281728', '6260004281759', '6260004281773',
        '6260004512402', '6260004512495', '6260004512570', '6260002532693', '6260004277141',
        '6260004277196', '6260004281742', '6260002676694', '6260303700319', '6260004512488',
        '6260004512501', '6260004512624', '6260004512679', '6260303700302', '6260002676601',
        '6260004277103', '6260004512440', '6260004512457', '6260004512525', '6260004512556',
        '6260002676663', '6260004512686', '6260004512693', '6260004512594', '6260004281735',
        '6260004512518', '6260004512587', '6260004512471', '6260004512617', '6260004512631',
        '6260002676670', '6260002676687', '6260004512662'
    ];

    const packageTypes = [
        'بطری', 'جعبه', 'کیسه', 'جعبه', 'قوطی',
        'کیسه', 'کیسه', 'بطری', 'بطری', 'بطری',
        'بطری', 'کیسه', 'کیسه', 'بطری', 'بطری',
        'بطری', 'کیسه', 'کیسه', 'جعبه', 'جعبه',
        'جعبه', 'بطری', 'بطری', 'بطری', 'بطری',
        'بطری', 'جعبه', 'جعبه', 'کیسه', 'قوطی',
        'بطری', 'بطری', 'قوطی', 'بطری', 'بطری',
        'کیسه', 'کیسه', 'قوطی', 'بطری', 'بطری',
        'بطری', 'بطری', 'بطری', 'جعبه', 'جعبه',
        'کیسه', 'بطری', 'بطری', 'بطری', 'قوطی',
        'قوطی', 'کیسه', 'جعبه', 'جعبه', 'کیسه',
        'قوطی', 'بطری', 'بطری', 'کیسه', 'قوطی',
        'قوطی', 'کیسه', 'کیسه', 'قوطی', 'بطری',
        'بطری', 'بطری', 'قوطی', 'کیسه', 'بطری',
        'بطری', 'بطری', 'کیسه', 'بطری', 'کیسه',
        'بطری', 'بطری', 'بطری', 'کیسه', 'بطری',
        'بطری', 'بطری', 'کیسه', 'کیسه', 'کیسه',
        'کیسه', 'بطری', 'بطری', 'بطری', 'بطری',
        'بطری', 'کیسه', 'کیسه', 'کیسه', 'کیسه',
        'بطری', 'کیسه', 'کیسه', 'بطری', 'بطری',
        'بطری', 'کیسه', 'کیسه', 'بطری', 'کیسه',
        'قوطی', 'بطری', 'بطری', 'کیسه', 'کیسه',
        'قوطی', 'کیسه', 'کیسه', 'کیسه', 'بطری',
        'بطری', 'بطری', 'بطری', 'بطری', 'کیسه',
        'بطری', 'کیسه', 'کیسه', 'کیسه', 'کیسه'
    ];


    const realIrancodeBarcodeData = productLines.map((description, index) => {
        return {
            id: index + 1, // Sequential ID
            description: description,
            packageType: packageTypes[index] || 'نامشخص', // New column
            brand: brands[index] || 'نامشخص', // Assign brand from the new array
            irancode: '0',
            barcode: barcodes[index] || '0' // Assign barcode from the new array
        };
    });
    // --- END OF NEW DATA ---


    // Function to convert Persian numerals to English numerals
    function convertPersianToEnglishNumbers(str) {
        if (typeof str !== 'string') return str;
        const persianNumbers = ['۰', '۱', '۲', '۳', '۴', '۵', '۶', '۷', '۸', '۹'];
        const englishNumbers = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
        return str.replace(/[۰-۹]/g, function(d) {
            return englishNumbers[persianNumbers.indexOf(d)];
        });
    }

    // Function to format a number with commas
    function formatNumberWithCommas(numberString) {
        // Remove existing commas, convert Persian to English numbers first
        let cleanedString = convertPersianToEnglishNumbers(String(numberString)).replace(/,/g, '');
        // Check if it's a valid number
        if (isNaN(cleanedString) || cleanedString === '' || cleanedString === '-' || cleanedString === '---') {
            return numberString; // Return original if not a number or special character
        }
        // Convert to number and then format
        return Number(cleanedString).toLocaleString('en-US');
    }

    // --- Dark Mode Logic ---
    function enableDarkMode() {
        document.body.classList.add('dark-mode');
        darkModeIcon.classList.remove('fa-moon');
        darkModeIcon.classList.add('fa-sun');
        localStorage.setItem('theme', 'dark');
    }

    function disableDarkMode() {
        document.body.classList.remove('dark-mode');
        darkModeIcon.classList.remove('fa-sun');
        darkModeIcon.classList.add('fa-moon');
        localStorage.setItem('theme', 'light');
    }

    // Check saved theme preference on load
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') {
        enableDarkMode();
    } else {
        disableDarkMode(); // Ensure light mode is applied if no preference or 'light'
    }

    // Toggle theme on button click
    darkModeToggle.addEventListener('click', () => {
        if (document.body.classList.contains('dark-mode')) {
            disableDarkMode();
        } else {
            enableDarkMode();
        }
    });

    // --- Shamsi Date and Time ---
    function getShamsiDate() {
        const now = new Date();
        const options = {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            hour12: false // Use 24-hour format
        };
        // Use 'fa-IR' locale for Persian/Shamsi date
        const shamsiDate = new Intl.DateTimeFormat('fa-IR', options).format(now);
        shamsiDateTimeDiv.textContent = shamsiDate;
    }

    // Update time every second
    setInterval(getShamsiDate, 1000);
    // Initial call
    getShamsiDate();

    // Populate irancodeBarcodeRows from realIrancodeBarcodeData
    let irancodeBarcodeRows = '';
    realIrancodeBarcodeData.forEach((product, index) => {
        irancodeBarcodeRows += `
            <tr>
                <td>${index + 1}</td>
                <td>${product.description}</td>
                <td>${product.packageType}</td> 
                <td>${product.brand}</td>
                <td>${product.irancode}</td>
                <td>${product.barcode}</td>
            </tr>
        `;
    });

    // --- Product Data (simulated) ---
    const productsData = {
        razavi: `
            <div class="search-container">
                <div class="autocomplete">
                    <input type="text" id="searchInput" placeholder="بخشی از نام محصول را وارد کنید...">
                </div>
                <button id="searchButton">جستجو</button>
            </div>
            <h2>قیمت محصولات رضوی مرداد ۱۴۰۴ با احتساب ۱۰ درصد مالیات ارزش افزوده</h2>
            <table id="productTable">
                <thead>
                    <tr>
                        <th>ردیف</th>
                        <th>نام محصول</th>
                        <th>وزن گرم</th>
                        <th>نوع بسته بندی</th>
                        <th>قیمت تولید (ریال)</th>
                        <th>قیمت مصرف کننده (ریال)</th>
                        <th>پروانه ساخت</th> 
                    </tr>
                </thead>
                <tbody>
                    <tr><td>1</td><td>پودر فلفل سیاه</td><td>100</td><td>پت</td><td>1521520</td><td>1901564</td><td>6877/ظ/50</td></tr>
                    <tr><td>2</td><td>پودر فلفل قرمز</td><td>100</td><td>پت</td><td>755651</td><td>944564</td><td>6849/ظ/50</td></tr>
                    <tr><td>3</td><td>پودر آویشن</td><td>50</td><td>پت</td><td>1035651</td><td>1294564</td><td>6909/ظ/50</td></tr>
                    <tr><td>4</td><td>پودر سماق</td><td>100</td><td>پت</td><td>1027651</td><td>1284564</td><td>6847/ظ/50</td></tr>
                    <tr><td>5</td><td>پودر دارچین</td><td>100</td><td>پت</td><td>723651</td><td>904564</td><td>6854/ظ/50</td></tr>
                    <tr><td>6</td><td>پودر زردچوبه</td><td>100</td><td>پت</td><td>643651</td><td>804564</td><td>6941/ظ/50</td></tr>
                    <tr><td>7</td><td>پودر کاری</td><td>100</td><td>پت</td><td>795651</td><td>994564</td><td>6856/ظ/50</td></tr>
                    <tr><td>8</td><td>پودر زنجبیل</td><td>100</td><td>پت</td><td>947651</td><td>1184564</td><td>6876/ظ/50</td></tr>
                    <tr><td>9</td><td>پودر سیر</td><td>100</td><td>پت</td><td>899651</td><td>1124564</td><td>6846/ظ/50</td></tr>
                </tbody>
            </table>
        `,
        gildokht: `
            <div class="search-container">
                <div class="autocomplete">
                    <input type="text" id="searchInput" placeholder="بخشی از نام محصول را وارد کنید...">
                </div>
                <button id="searchButton">جستجو</button>
            </div>
            <h2>لیست قیمت محصولات گیل دخت خرداد ۱۴۰۴ با احتساب ۱۰ درصد مالیات ارزش افزوده</h2>
            <table id="productTable">
                <thead>
                    <tr>
                        <th>ردیف</th>
                        <th>نام محصول</th>
                        <th>نوع بسته بندی</th>
                        <th>وزن</th>
                        <th>قیمت تولید</th>
                        <th>قیمت مصرف کننده</th>
                        <th>پروانه ساخت</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>1</td><td>پودر فلفل سیاه</td><td>پت</td><td>90 گرم</td><td>1488720</td><td>1860900</td><td>50/24173</td></tr>
                    <tr><td>2</td><td>پودر فلفل قرمز</td><td>پت</td><td>90 گرم</td><td>729520</td><td>911900</td><td>50/24272</td></tr>
                    <tr><td>3</td><td>آویشن</td><td>پت</td><td>50 گرم</td><td>1035920</td><td>1294900</td><td>50/24103</td></tr>
                    <tr><td>4</td><td>پودر سماق</td><td>پت</td><td>90 گرم</td><td>970320</td><td>1212900</td><td>50/24104</td></tr>
                    <tr><td>5</td><td>پودر دارچین</td><td>پت</td><td>90 گرم</td><td>764720</td><td>955900</td><td>50/24108</td></tr>
                    <tr><td>6</td><td>زرد چوبه</td><td>پت</td><td>90 گرم</td><td>623920</td><td>779900</td><td>50/24106</td></tr>
                    <tr><td>7</td><td>پودر کاری</td><td>پت</td><td>90 گرم</td><td>817520</td><td>1021900</td><td>50/24273</td></tr>
                    <tr><td>8</td><td>زنجبیل</td><td>پت</td><td>90 گرم</td><td>940720</td><td>1175900</td><td>50/24109</td></tr>
                    <tr><td>8</td><td>پودر سیر</td><td>پت</td><td>100 گرم</td><td>993520</td><td>1241900</td><td>50/24110</td></tr>
                    <tr><td>10</td><td>شکر</td><td>900 گرم</td><td>900 گرم</td><td>801000</td><td>890000</td><td>50/30520</td></tr>
                </tbody>
            </table>
        `,
        khatomeh: `
            <div class="search-container">
                <div class="autocomplete">
                    <input type="text" id="searchInput" placeholder="بخشی از نام محصول را وارد کنید...">
                </div>
                <button id="searchButton">جستجو</button>
            </div>
            <h2>لیست قیمت محصولات خاتومه (لطفاً ستون‌های خالی را تکمیل کنید)</h2>
            <table id="productTable">
                <thead>
                    <tr>
                        <th>ردیف</th>
                        <th>نام محصول</th>
                        <th>وزن گرم</th>
                        <th>نوع بسته بندی</th>
                        <th>قیمت تولید (ریال)</th>
                        <th>قیمت مصرف کننده (ریال)</th>
                        <th>پروانه ساخت</th> 
                    </tr>
                </thead>
                <tbody>
                    <tr><td>1</td><td>پودر زردچوبه</td><td>100</td><td>قوطی</td><td>-</td><td>-</td><td>---</td></tr>
                    <tr><td>2</td><td>پودر سیر</td><td>100</td><td>قوطی</td><td>-</td><td>-</td><td>---</td></tr>
                    <tr><td>3</td><td>پودر فلفل قرمز</td><td>100</td><td>قوطی</td><td>-</td><td>-</td><td>---</td></tr>
                    <tr><td>4</td><td>پودر سماق</td><td>100</td><td>قوطی</td><td>-</td><td>-</td><td>---</td></tr>
                    <tr><td>5</td><td>پودر دارچین</td><td>100</td><td>قوطی</td><td>-</td><td>-</td><td>---</td></tr>
                    <tr><td>6</td><td>پودر ادویه کاری</td><td>100</td><td>قوطی</td><td>-</td><td>-</td><td>---</td></tr>
                    <tr><td>7</td><td>پودر آویشن</td><td>60</td><td>قوطی</td><td>-</td><td>-</td><td>---</td></tr>
                    <tr><td>8</td><td>پودر زنجبیل</td><td>100</td><td>قوطی</td><td>-</td><td>-</td><td>---</td></tr>
                    <tr><td>9</td><td>پودر فلفل سیاه</td><td>100</td><td>قوطی</td><td>-</td><td>-</td><td>---</td></tr>
                    <tr><td>10</td><td>پودر سیر</td><td>120</td><td>قوطی</td><td>-</td><td>-</td><td>---</td></tr>
                    <tr><td>11</td><td>پودر سیر</td><td>75</td><td>سلفون</td><td>-</td><td>-</td><td>---</td></tr>
                    <tr><td>12</td><td>پودر دارچین</td><td>75</td><td>سلفون</td><td>-</td><td>-</td><td>---</td></tr>
                    <tr><td>13</td><td>پودر فلفل قرمز</td><td>75</td><td>سلفون</td><td>-</td><td>-</td><td>---</td></tr>
                    <tr><td>14</td><td>پودر ادویه کاری</td><td>75</td><td>سلفون</td><td>-</td><td>-</td><td>---</td></tr>
                    <tr><td>15</td><td>پودر سیر</td><td>50</td><td>سلفون</td><td>-</td><td>-</td><td>---</td></tr>
                    <tr><td>16</td><td>پودر سماق</td><td>50</td><td>سلفون</td><td>-</td><td>-</td><td>---</td></tr>
                    <tr><td>17</td><td>پودر دارچین</td><td>50</td><td>سلفون</td><td>-</td><td>-</td><td>---</td></tr>
                    <tr><td>18</td><td>پودر فلفل قرمز</td><td>50</td><td>سلفون</td><td>-</td><td>-</td><td>---</td></tr>
                    <tr><td>19</td><td>پودر ادویه کاری</td><td>50</td><td>سلفون</td><td>-</td><td>-</td><td>---</td></tr>
                    <tr><td>20</td><td>پودر آویشن</td><td>30</td><td>سلفون</td><td>-</td><td>-</td><td>---</td></tr>
                </tbody>
            </table>
        `,
        'irancode-barcode': `
            <div class="search-container">
                <div class="autocomplete">
                    <input type="text" id="searchInput" placeholder="بخشی از شرح کالا یا ایرانکد/بارکد را وارد کنید...">
                </div>
                <select id="brandFilter">
                    <option value="">فیلتر با نام تجاری: همه</option>
                    <option value="گیل دخت">گیل دخت</option>
                    <option value="خاتومه">خاتومه</option>
                    <option value="مسیر سبز">مسیر سبز</option>
                </select>
                <button id="searchButton">جستجو</button>
            </div>
            <h2>جدول ایرانکد و بارکد محصولات</h2>
            <table id="productTable">
                <thead>
                    <tr>
                        <th>ردیف</th>
                        <th>شرح کالا</th>
                        <th>نوع بسته بندی</th> 
                        <th>نام تجاری</th> 
                        <th>ایرانکد</th>
                        <th>بارکد</th>
                    </tr>
                </thead>
                <tbody>
                    ${irancodeBarcodeRows}
                </tbody>
            </table>
        `
    };

    function loadProductContent(productKey) {
        welcomeMessageDiv.style.display = 'none'; // Hide welcome message
        productSpecificContentDiv.innerHTML = productsData[productKey]; // Load content
        productSpecificContentDiv.style.display = 'block'; // Show product content

        // Convert numbers to English and format with commas in the loaded table
        const loadedTable = productSpecificContentDiv.querySelector('#productTable');
        if (loadedTable) {
            let cellsToConvertAndFormat = [];
            if (productKey === 'irancode-barcode') {
                // For irancode-barcode table, format 'ردیف' (1st column)
                cellsToConvertAndFormat = loadedTable.querySelectorAll('td:nth-child(1)');
            } else {
                // For other product tables, format Radeef, Vazn Gram, Gheymat Tolid, Gheymat Masraf Konandeh
                cellsToConvertAndFormat = loadedTable.querySelectorAll('td:nth-child(1), td:nth-child(3), td:nth-child(5), td:nth-child(6)'); 
            }
            
            cellsToConvertAndFormat.forEach(cell => {
                let originalText = cell.textContent.trim();
                let convertedAndFormattedText = originalText;

                if (originalText.includes('گرم') || originalText.includes('کیلوگرم')) {
                    // Handle cases like "90 گرم" or "900 گرم" where we only want to format the number part
                    const parts = originalText.split(' ');
                    if (parts.length > 1) {
                        const numberPart = formatNumberWithCommas(parts[0]);
                        convertedAndFormattedText = numberPart + ' ' + parts[1];
                    } else {
                        convertedAndFormattedText = formatNumberWithCommas(originalText);
                    }
                } else if (originalText === '-' || originalText === '---') {
                    // Do nothing for hyphens or "---"
                    convertedAndFormattedText = originalText;
                } else {
                    // For pure numbers (like Radeef, Gheymat Tolid, Gheymat Masraf Konandeh, Irancode/Barcode Radeef)
                    convertedAndFormattedText = formatNumberWithCommas(originalText);
                }
                cell.textContent = convertedAndFormattedText;
            });
        }


        // Re-initialize search and autocomplete for the newly loaded content
        const newSearchInput = document.getElementById('searchInput');
        const newSearchButton = document.getElementById('searchButton');
        const newProductTable = document.querySelector('#productSpecificContent #productTable'); // Get the table itself
        
        // Only run search/autocomplete setup if a table is present for the loaded content
        if (newProductTable) {
            const newMainTableBody = newProductTable.querySelector('tbody');
            if (newSearchInput && newSearchButton && newMainTableBody) {
                let searchData = [];
                const productRows = Array.from(newMainTableBody.getElementsByTagName('tr'));

                if (productKey === 'irancode-barcode') {
                    // Autocomplete data now comes from realIrancodeBarcodeData for consistency
                    searchData = realIrancodeBarcodeData.map(item => 
                        `${item.description} ${item.packageType} ${item.brand} ${item.irancode} ${item.barcode}`
                    );
                } else {
                    searchData = productRows.map(row => row.getElementsByTagName('td')[1].textContent.trim());
                }

                // Attach event listeners to the new elements
                newSearchButton.onclick = () => performSearch(newSearchInput, newMainTableBody, productKey);
                newSearchInput.addEventListener('keyup', (event) => {
                    if (event.key === 'Enter') {
                        performSearch(newSearchInput, newMainTableBody, productKey);
                    }
                });
                autocomplete(newSearchInput, searchData);

                // --- Specific logic for irancode-barcode table filters ---
                if (productKey === 'irancode-barcode') {
                    const brandFilter = document.getElementById('brandFilter');
                    if (brandFilter) {
                        // Initial filter application
                        applyIrancodeBarcodeFilter(); 
                        brandFilter.addEventListener('change', applyIrancodeBarcodeFilter);
                        newSearchInput.addEventListener('input', applyIrancodeBarcodeFilter);
                    }
                }
            }

            // Add click event listener to table rows for highlighting
            const rows = newProductTable.querySelectorAll('tbody tr');
            rows.forEach(row => {
                row.addEventListener('click', function() {
                    // Remove highlight from all other rows in this table
                    rows.forEach(r => r.classList.remove('highlight'));
                    // Add highlight to the clicked row
                    this.classList.add('highlight');
                });
            });
        }
        closeNav(); // Close sidebar after selection
    }

    // New function to apply filters for irancode-barcode table
    function applyIrancodeBarcodeFilter() {
        const searchInput = document.getElementById('searchInput');
        const brandFilter = document.getElementById('brandFilter');
        const tableBody = document.querySelector('#productSpecificContent #productTable tbody');
        if (!tableBody) return;

        const searchText = searchInput ? searchInput.value.trim().toLowerCase() : '';
        const selectedBrand = brandFilter ? brandFilter.value.trim().toLowerCase() : '';

        Array.from(tableBody.children).forEach(row => {
            const description = row.getElementsByTagName('td')[1].textContent.toLowerCase();
            const packageType = row.getElementsByTagName('td')[2].textContent.toLowerCase(); // Get package type
            const brand = row.getElementsByTagName('td')[3].textContent.toLowerCase(); // Get brand
            const irancode = row.getElementsByTagName('td')[4].textContent.toLowerCase();
            const barcode = row.getElementsByTagName('td')[5].textContent.toLowerCase();

            const textMatch = description.includes(searchText) || 
                              packageType.includes(searchText) || // Search in package type
                              irancode.includes(searchText) || 
                              barcode.includes(searchText) ||
                              brand.includes(searchText); // Also search in brand name

            const brandMatch = (selectedBrand === '' || brand === selectedBrand);

            if (textMatch && brandMatch) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    }


    // Function to perform search (now takes input and tbody elements)
    const performSearch = (inputElem, tableBodyElem, productKey) => {
        const query = inputElem.value.trim().toLowerCase();
        // If it's the irancode-barcode table, we search based on the currently displayed (filtered) rows.
        // Otherwise, we search all rows as before.
        const rowsToSearch = productKey === 'irancode-barcode' 
            ? Array.from(tableBodyElem.children).filter(row => row.style.display !== 'none')
            : Array.from(tableBodyElem.children);

        if (!query && productKey !== 'irancode-barcode') { // For other tables, if no query, show alert
            alert("لطفاً نام محصولی را برای جستجو وارد کنید.");
            return;
        }

        let resultFound = false;
        modalBody.innerHTML = '';

        const resultTable = document.createElement('table');
        // Clone header from the product table that is currently displayed
        const currentProductTable = document.querySelector('#productSpecificContent #productTable');
        const tableHeader = currentProductTable ? currentProductTable.querySelector('thead').cloneNode(true) : null;
        if (tableHeader) resultTable.appendChild(tableHeader);
        
        const resultTbody = document.createElement('tbody');
        resultTable.appendChild(resultTbody);
        
        // Use the rows from the provided tableBodyElem
        
        rowsToSearch.forEach(row => {
            let rowContent = '';
            if (productKey === 'irancode-barcode') {
                const description = row.getElementsByTagName('td')[1].textContent.toLowerCase();
                const packageType = row.getElementsByTagName('td')[2].textContent.toLowerCase(); // Get package type
                const brand = row.getElementsByTagName('td')[3].textContent.toLowerCase(); // Get brand
                const irancode = row.getElementsByTagName('td')[4].textContent.toLowerCase();
                const barcode = row.getElementsByTagName('td')[5].textContent.toLowerCase();
                rowContent = `${description} ${packageType} ${brand} ${irancode} ${barcode}`;
            } else {
                rowContent = row.getElementsByTagName('td')[1].textContent.toLowerCase();
            }

            if (query === "" || rowContent.includes(query)) { // If query is empty, all currently visible rows are results
                const clonedRow = row.cloneNode(true);
                resultTbody.appendChild(clonedRow);
                resultFound = true;
            }
        });

        if (resultFound) {
            modalBody.appendChild(resultTable);
             // Convert numbers to English and format with commas in the modal table
            const modalTable = modalBody.querySelector('table');
            if (modalTable) {
                let cellsToConvertAndFormat = [];
                if (productKey === 'irancode-barcode') {
                    cellsToConvertAndFormat = modalTable.querySelectorAll('td:nth-child(1)');
                } else {
                    cellsToConvertAndFormat = modalTable.querySelectorAll('td:nth-child(1), td:nth-child(3), td:nth-child(5), td:nth-child(6)');
                }

                cellsToConvertAndFormat.forEach(cell => {
                    let originalText = cell.textContent.trim();
                    let convertedAndFormattedText = originalText;

                    if (originalText.includes('گرم') || originalText.includes('کیلوگرم')) {
                        const parts = originalText.split(' ');
                        if (parts.length > 1) {
                            const numberPart = formatNumberWithCommas(parts[0]);
                            convertedAndFormattedText = numberPart + ' ' + parts[1];
                        } else {
                            convertedAndFormattedText = formatNumberWithCommas(originalText);
                        }
                    } else if (originalText === '-' || originalText === '---') {
                        convertedAndFormattedText = originalText;
                    } else {
                        convertedAndFormattedText = formatNumberWithCommas(originalText);
                    }
                    cell.textContent = convertedAndFormattedText;
                });
            }
        } else {
            modalBody.innerHTML = '<p style="text-align:center; font-weight: bold;">محصولی با این مشخصات یافت نشد.</p>';
        }
        
        modal.style.display = 'block';

        // Add highlight logic to rows in the modal too
        const modalRows = modalBody.querySelectorAll('tbody tr');
        modalRows.forEach(row => {
            row.addEventListener('click', function() {
                modalRows.forEach(r => r.classList.remove('highlight'));
                this.classList.add('highlight');
            });
        });
    };

    // Modal close handlers
    closeModal.onclick = function() {
        modal.style.display = 'none';
    }

    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    }

    // Autocomplete logic (unchanged, just needs to be called on new searchInput)
    function autocomplete(inp, arr) {
        let currentFocus;
        inp.addEventListener("input", function(e) {
            let a, b, i, val = this.value;
            closeAllLists();
            if (!val) { return false; }
            currentFocus = -1;
            a = document.createElement("DIV");
            a.setAttribute("id", this.id + "autocomplete-list");
            a.setAttribute("class", "autocomplete-items");
            this.parentNode.appendChild(a);

            for (i = 0; i < arr.length; i++) {
                if (arr[i].toLowerCase().includes(val.toLowerCase())) {
                    b = document.createElement("DIV");
                    const regex = new RegExp(val, 'gi');
                    b.innerHTML = arr[i].replace(regex, (match) => `<strong>${match}</strong>`);
                    b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
                    b.addEventListener("click", function(e) {
                        inp.value = this.getElementsByTagName("input")[0].value;
                        closeAllLists();
                    });
                    a.appendChild(b);
                }
            }
        });

        inp.addEventListener("keydown", function(e) {
            let x = document.getElementById(this.id + "autocomplete-list");
            if (x) x = x.getElementsByTagName("div");
            if (e.keyCode == 40) { // Arrow DOWN
                currentFocus++;
                addActive(x);
            } else if (e.keyCode == 38) { // Arrow UP
                currentFocus--;
                addActive(x);
            } else if (e.keyCode == 13) { // Enter
                e.preventDefault();
                if (currentFocus > -1) {
                    if (x) x[currentFocus].click();
                }
            }
        });

        function addActive(x) {
            if (!x) return false;
            removeActive(x);
            if (currentFocus >= x.length) currentFocus = 0;
            if (currentFocus < 0) currentFocus = (x.length - 1);
            x[currentFocus].classList.add("autocomplete-active");
        }

        function removeActive(x) {
            for (let i = 0; i < x.length; i++) {
                x[i].classList.remove("autocomplete-active");
            }
        }

        function closeAllLists(elmnt) {
            const x = document.getElementsByClassName("autocomplete-items");
            for (let i = 0; i < x.length; i++) {
                if (elmnt != x[i] && elmnt != inp) {
                    x[i].parentNode.removeChild(x[i]);
                }
            }
        }

        document.addEventListener("click", function (e) {
            closeAllLists(e.target);
        });
    }

    // --- Sidebar Open/Close Logic ---
    function openNav() {
        mySidebar.classList.add('active'); // Use class for active state
        myOverlay.classList.add('active');
        document.body.classList.add('sidebar-open');
        
        // Handle width based on screen size
        if (window.innerWidth <= 768) {
            mySidebar.style.width = "70vw";
            document.body.classList.add('sidebar-open-mobile');
            document.body.classList.remove('sidebar-open'); // Remove desktop specific class
        } else {
            mySidebar.style.width = "250px";
            document.body.classList.remove('sidebar-open-mobile'); // Remove mobile specific class
            document.body.classList.add('sidebar-open'); // Add desktop specific class
        }
    }

    function closeNav() {
        mySidebar.classList.remove('active');
        mySidebar.style.width = "0"; // Explicitly set width to 0
        myOverlay.classList.remove('active');
        document.body.classList.remove('sidebar-open');
        document.body.classList.remove('sidebar-open-mobile');
    }

    openSidebarBtn.onclick = openNav;
    closeSidebarBtn.onclick = closeNav;
    myOverlay.onclick = closeNav;

    // --- Sidebar Dropdown Logic ---
    const dropdownToggles = document.querySelectorAll('.sidebar ul li.dropdown > a');

    dropdownToggles.forEach(toggle => {
        toggle.addEventListener('click', function(event) {
            event.preventDefault(); // Prevent default link behavior if it's a link
            const dropdownContent = this.nextElementSibling; // The ul.dropdown-content
            const dropdownIcon = this.querySelector('.dropdown-icon');

            // Toggle active class on dropdown content
            dropdownContent.classList.toggle('active');
            // Rotate the icon
            dropdownIcon.classList.toggle('rotated');
        });
    });


    // --- Sidebar Sub-link Click Handlers (for actual product/irancode links) ---
    const sidebarSubLinks = document.querySelectorAll('.sidebar ul li .dropdown-content li a');
    sidebarSubLinks.forEach(link => {
        link.addEventListener('click', function(event) {
            event.preventDefault(); // Prevent default link behavior
            
            // Remove active class from all sub-links AND main dropdown links
            document.querySelectorAll('.sidebar ul li a').forEach(item => item.classList.remove('active'));
            // Add active class to clicked link
            this.classList.add('active');

            const productType = this.dataset.product; // Get data-product attribute
            loadProductContent(productType);
        });
    });

    // Handle window resize for sidebar
    window.addEventListener('resize', () => {
        if (mySidebar.classList.contains('active')) {
            if (window.innerWidth <= 768) {
                mySidebar.style.width = "70vw";
                document.body.classList.add('sidebar-open-mobile');
                document.body.classList.remove('sidebar-open');
            } else {
                mySidebar.style.width = "250px";
                document.body.classList.remove('sidebar-open-mobile');
                document.body.classList.add('sidebar-open');
            }
        }
    });

    // Initial state: Only welcome message and date/time are visible.
    // No product content is loaded until a sidebar link is clicked.
});
</script>

</body>
</html>
